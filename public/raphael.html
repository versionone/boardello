<doctype html>
<html>
<head>

<script type="text/javascript" src="javascripts/raphael.js"></script>
<script type="text/javascript" src="javascripts/jquery-1.6.4.js"></script>
<script type="text/javascript" src="socket.io/socket.io.js"></script>


<script type="text/javascript">
	var socket = io.connect('http://localhost');
	

	// Creates canvas 320 Ã— 200 at 10, 50
	var board = Raphael(10, 50, 800, 600);
	var cards = [];

	function createCard(titleText) {

		var title = board.text(75, 75, titleText);

		var card = board.set();
		card.id = cards.length;
		cards.push(card);

		var offset = 30 * card.id;
		card.push(
			title,
			board.circle(50, 50, 10),
			board.circle(50, 150, 10),
			board.circle(250, 50, 10),
			board.circle(250, 150, 10),
			board.rect(50, 50, 200, 100, 5)
		)

		card.translate(offset, offset)

		card.attr({
		    fill: "red",
		    stroke: "none",
		    opacity: .5
		});

		title.attr({
			fill: "white",
			stroke: "black",
			opacity: 1
		}).toFront();

		var start = function () {
			    card.originalBoundingBox = card.getBBox();
			    card.attr({opacity: 1});
			},
			move = function (dx, dy) {
			    var currentBoundingBox = card.getBBox();
				card.translate(card.originalBoundingBox.x - currentBoundingBox.x + dx, card.originalBoundingBox.y - currentBoundingBox.y + dy);
			},
			up = function () {
			    card.attr({opacity: .5});
			    title.attr({opacity: 1})
			    var position = card.getBBox();
			    socket.emit('card moved', {id: card.id, x: position.x, y: position.y});
			};

		card.drag(move, start, up);
		
		return card;
	}

	socket.on('card moved', function (data) {
		console.log(data);
		var card = cards[data.id]
		var currentBoundingBox = card.getBBox();
		card.translate(data.x - currentBoundingBox.x , data.y - currentBoundingBox.y );

	});

	createCard('hi')
	createCard('dave')
	createCard('dan')

</script>


</head>
<body>


</body>
</html>